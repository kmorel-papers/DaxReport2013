% -*- latex -*-
%
% The SAND document class is maintained at:
%
%    http://www.cs.sandia.gov/SANDreport/sandHome.html
%
% This page also as instructions and documentation on commands.
%
\documentclass[12pt,report]{SANDreport}

\SANDnum{SAND2013-xxxx}
\SANDprintDate{December 2013}

\title{A Pervasive Parallel Framework for Visualization: Final Report for
  FWP~10-014707}
\author{Kenneth~Moreland}
\SANDauthor{Kenneth~Moreland}
\date{} % Leave empty


\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{isomath}
\usepackage{varioref}
\usepackage{fancyvrb}
\usepackage{ifthen}
\usepackage{cite}
\usepackage{subfig}
\usepackage{xspace}

% This wonderful package allows hyphenation in tt fonts and hyphenation of
% words with underscores in them.
\usepackage[htt]{hyphenat}

% This package defines a tt font that supports boldface (albeit not very
% distinctly). The default package has no boldface for tt fonts.
\usepackage{lmodern}

\usepackage{makeidx}
\makeindex

\usepackage[pdfborder={0 0 0}]{hyperref}
\usepackage{verbatim}

\usepackage{color}
\definecolor{yellow}{rgb}{1,1,0}
\definecolor{black}{rgb}{0,0,0}
\definecolor{ltcyan}{rgb}{.75,1,1}
\definecolor{red}{rgb}{1,0,0}
\definecolor{gray}{rgb}{.6,.6,.6}
\definecolor{darkred}{rgb}{0.5,0,0}
\definecolor{darkgreen}{rgb}{0,0.5,0}

\definecolor{daxidentifier}{rgb}{0,0,1}
\definecolor{daxnamespace}{rgb}{0.5,0,0}
\definecolor{daxmacro}{rgb}{0.5,0,0}
\definecolor{daxsignature}{rgb}{0,0.5,0}

\usepackage{listings}
\lstloadlanguages{C,C++}
\lstset{fontadjust=false,basicstyle=\scriptsize\ttfamily}
%% \lstset{numbers=left, numberstyle=\tiny, stepnumber=1, numbersep=2pt}
\lstdefinelanguage{Dax}{
  morekeywords={struct,class,public,typedef, void, template, return, operator, const, for, int},
  morekeywords={[2]Id,Id2,Id3,Scalar,Tuple,Vector2,Vector3,Vector4,
                   make_Id2,make_Id3,make_Vector2,make_Vector3,make_Vector4,
                   dot,NUM_COMPONENTS,
                   Extent3,Pair,
                   extentDimensions, extentCellDimensions,
                   flatIndexToIndex3Cell, index3ToFlatIndex,
                   index3ToFlatIndexCell,
                   WorkletMapField, WorkletMapCell,
                   WorkletGenerateTopology, WorkletInterpolatedCell,
                   WorkletGenerateKeysValues, WorkletReduceKeysValues,
                   TypeTraits,NumericTag,DimensionalityTag,
                   TypeTraitsRealTag,TypeTraitsIntegerTag,
                   TypeTraitsScalarTag,TypeTraitsVectorTag,
                   VectorTraits,ComponentType,HasMultipleComponents,
                   VectorTraitsTagMultipleComponents,
                   VectorTraitsTagSingleComponent,
                   Error, ErrorExecution, ErrorControl,
                   ErrorControlAssert, ErrorControlBadValue,
                   ErrorControlInternal, ErrorControlOutOfMemory,
                   DeviceAdapterTagSerial,
                   DeviceAdapterTagCuda,
                   DeviceAdapterTagOpenMP,
                   DeviceAdapterTagTBB,
                   CellAverage,
                   CellDataToPointDataGenerateKeys,CellDataToPointDataReduceKeys,
                   CellGradient,
                   Cosine,Sine,Magnitude,Square,
                   Elevation,
                   MarchingCubesClassify,MarchingCubesGenerate,
                   PointDataToCellData,
                   SliceClassify,SliceGenerate,
                   Tetrahedralize,
                   ThresholdClassify,ThresholdTopology,
                   ArrayHandle,make_ArrayHandle,
                   ArrayHandleConstant,make_ArrayHandleConstant,
                   ArrayHandleCounting,make_ArrayHandleCounting,
                   ArrayContainerControl,
                   ArrayContainerControlTagBasic,
                   ArrayContainerControlTagImplicit,
                   ArrayTransfer,
                   ArrayManagerExecution,
                   ArrayManagerExecutionShareWithControl,
                   DeviceAdapterAlgorithm, DeviceAdapterAlgorithmGeneral,
                   IteratorFromArrayPortal,
                   GenerateInterpolatedCells,
                   GenerateTopology,
                   GenerateKeysValues,ReduceKeysValues,
                   UniformGrid,UnstructuredGrid,
                   Scheduler,
                   CellField, CellVertices,
                   InterpolatedCellPoints,
                   CellTraits,NUM_VERTICES,
                   CellTagHexahedron, CellTagLine, CellTagQuadrilateral,
                   CellTagTetrahedron, CellTagTriangle, CellTagVectex,
                   CellTagVoxel, CellTagWedge,
                   ParametricCoordinates, CellDerivative,
                   SortLess, SortGreater,
                   Max, Min,
                   Cbrt, Exp, Exp10, Exp2, ExpM1, Log, Log10, Log1P, Log2,
                   Pow, RCbrt, RSqrt, Sqrt,
                   Matrix, Matrix2x2, Matrix3x3, Matrix4x4,
                   MatrixColumn, MatrixDeterminant, MatrixIdentity,
                   MatrixInverse, MatrixMultiply, MatrixRow,
                   MatrixSetColumn, MatrixSetRow, MatrixTranspose,
                   SolveLinearSystem,
                   NewtonsMethod,
                   Ceil, Epsilon, Floor, FMod, Infinity, IsFinite, IsInf,
                   IsNan, ModF, Nan, NegativeInfinity, Remainder,
                   RemainderQuotient, Round,
                   Abs, CopySign, IsNegative, SignBit,
                   ACos, ACosH, ASin, ASinH, ATan, ATan2, ATanH, Cos, CosH,
                   Pi, Sin, SinH, Tan, TanH,
                   Cross, Magnitude, MagnitudeSquared, Lerp, Normal,
                   Normalize, RMagnitude, TriangleNormal
                   },
  morekeywords={[3]DAX_CONT_EXPORT,DAX_EXEC_EXPORT,DAX_EXEC_CONT_EXPORT,
                   DAX_EXEC_CONSTANT_EXPORT,
                   DAX_DEVICE_ADAPTER,
                   DAX_DEVICE_ADAPTER_SERIAL,
                   DAX_DEVICE_ADAPTER_CUDA,
                   DAX_DEVICE_ADAPTER_OPENMP,
                   DAX_DEVICE_ADAPTER_TBB,
                   DAX_DEVICE_ADAPTER_ERROR,
                   DAX_DEFAULT_DEVICE_ADAPTER_TAG,
                   DAX_ARRAY_CONTAINER_CONTROL,
                   DAX_ARRAY_CONTAINER_CONTROL_BASIC,
                   DAX_ARRAY_CONTAINER_CONTROL_ERROR,
                   DAX_DEFAULT_ARRAY_CONTAINER_CONTROL_TAG,
                   DAX_ASSERT_CONT
                   },
  morekeywords={[4]dax,exec,cont,worklet,math,cuda,openmp,tbb,internal,detail},
  morekeywords={[5]ControlSignature, ExecutionSignature,
                   Field,Topology,Geometry,
                   In,Out,Point,Cell,Vertices,Values,KeyGroup,ExecObject,
                   WorkId,VisitIndex,
                   _1,_2,_3,_4,_5,_6,_7,_8,_9
                   }
}
\lstset{language=Dax}
\lstset{
  keywordstyle=\bfseries,
  keywordstyle=[2]\color{daxidentifier},
  keywordstyle=[3]\color{daxmacro},
  keywordstyle=[4]\color{daxnamespace},
  keywordstyle=[5]\color{daxsignature}
}

\renewcommand{\lstlistlistingname}{List of Examples}
\renewcommand{\lstlistingname}{Example}

\newcommand*{\textcode}[1]{\texttt{#1}}
\newcommand*{\textnamespace}[1]{\textcode{\color{daxnamespace}{#1}}}
\newcommand*{\textmacro}[1]{\textcode{\color{daxmacro}{#1}}}
\newcommand*{\textidentifier}[1]{\textcode{\color{daxidentifier}{#1}}}
\newcommand*{\textsignature}[1]{\textcode{\color{daxsignature}{#1}}}

\newcommand*{\daxmacro}[1]{\textmacro{#1}\index{#1}}

\newcommand{\daxcontexport}{\daxmacro{DAX\_CONT\_EXPORT}\index{export!control}\index{function~export}\index{method~export}\xspace}
\newcommand{\daxexecexport}{\daxmacro{DAX\_EXEC\_EXPORT}\index{export!execution}\index{function~export}\index{method~export}\xspace}
\newcommand{\daxexeccontexport}{\daxmacro{DAX\_EXEC\_CONT\_EXPORT}\index{export!control}\index{export!execution}\index{function~export}\index{method~export}\xspace}

\newcommand{\controlsignature}{\textsignature{ControlSignature}\index{control~signature}\index{signature!control}\xspace}
\newcommand{\executionsignature}{\textsignature{ExecutionSignature}\index{execution~signature}\index{signature!execution}\xspace}

\newcommand*{\sigtag}[1]{\textsignature{#1}\index{#1}\index{signature tags!#1}}
\newcommand*{\sigtagnum}[1]{\sigtag{\_#1}}
\newcommand*{\sigtagmod}[2]{\sigtag{#1}\textcode{(}\sigtag{#2}\textcode{)}}
\newcommand*{\sigtagmodnum}[2]{\sigtag{#1}\textcode{(}\sigtagnum{#2}\textcode{)}}

\newcommand*{\writenamespaceone}[1]{%
  \textnamespace{#1}}
\newcommand*{\writenamespacetwo}[2]{%
  \writenamespaceone{#1}\textcode{:\colonhyp}\textnamespace{#2}}
\newcommand*{\writenamespacethree}[3]{%
  \writenamespacetwo{#1}{#2}\textcode{:\colonhyp}\textnamespace{#3}}
\newcommand*{\writenamespacefour}[4]{%
  \writenamespacethree{#1}{#2}{#3}\textcode{:\colonhyp}\textnamespace{#4}}

\newcommand*{\indexnamespaceone}[1]{%
  \index{#1 namespace}\index{namespace!#1}}
\newcommand*{\indexnamespacetwo}[2]{%
  \index{#2 namespace}\index{#1::#2}\index{namespace!#1::#2}}
\newcommand*{\indexnamespacethree}[3]{%
  \index{#3 namespace}\index{#1::#2::#3}\index{namespace!#1::#2::#3}}
\newcommand*{\indexnamespacefour}[4]{%
  \index{#4 namespace}\index{#1::#2::#3::#4}\index{namespace!#1::#2::#3::#4}}

\newcommand*{\writeindexidentifierone}[2]{%
  \writenamespaceone{#1}\textcode{:\colonhyp}\textidentifier{#2}%
  \index{#2}}
\newcommand*{\writeindexidentifiertwo}[3]{%
  \writenamespacetwo{#1}{#2}\textcode{:\colonhyp}\textidentifier{#3}%
  \index{#3}}
\newcommand*{\writeindexidentifierthree}[4]{%
  \writenamespacethree{#1}{#2}{#3}\textcode{:\colonhyp}\textidentifier{#4}%
  \index{#4}}
\newcommand*{\writeindexidentifierfour}[5]{%
  \writenamespacefour{#1}{#2}{#3}{#4}\textcode{:\colonhyp}\textidentifier{#5}%
  \index{#5}}

\newcommand*{\dax}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespaceone{dax}\indexnamespaceone{dax}}%
             {\writeindexidentifierone{dax}{#1}}}
\newcommand*{\daxcont}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacetwo{dax}{cont}\indexnamespacetwo{dax}{cont}}%
             {\writeindexidentifiertwo{dax}{cont}{#1}}}
\newcommand*{\daxcontinternal}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacethree{dax}{cont}{internal}\indexnamespacethree{dax}{cont}{internal}}%
             {\writeindexidentifierthree{dax}{cont}{internal}{#1}}}
\newcommand*{\daxexec}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacetwo{dax}{exec}\indexnamespacetwo{dax}{exec}}%
             {\writeindexidentifiertwo{dax}{exec}{#1}}}
\newcommand*{\daxexecinternal}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacethree{dax}{exec}{internal}\indexnamespacethree{dax}{cont}{internal}}%
             {\writeindexidentifierthree{dax}{exec}{internal}{#1}}}
\newcommand*{\daxworklet}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacetwo{dax}{worklet}\indexnamespacetwo{dax}{worklet}}%
             {\writeindexidentifiertwo{dax}{worklet}{#1}}}
\newcommand*{\daxmath}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacetwo{dax}{math}\indexnamespacetwo{dax}{math}}%
             {\writeindexidentifiertwo{dax}{math}{#1}}}

\newcommand*{\daxcuda}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacetwo{dax}{cuda}\indexnamespacetwo{dax}{cuda}}%
             {\writeindexidentifiertwo{dax}{cuda}{#1}}}
\newcommand*{\daxcudacont}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacethree{dax}{cuda}{cont}\indexnamespacethree{dax}{cuda}{cont}}%
             {\writeindexidentifierthree{dax}{cuda}{cont}{#1}}}
\newcommand*{\daxopenmp}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacetwo{dax}{openmp}\indexnamespacetwo{dax}{openmp}}%
             {\writeindexidentifiertwo{dax}{openmp}{#1}}}
\newcommand*{\daxopenmpcont}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacethree{dax}{openmp}{cont}\indexnamespacethree{dax}{openmp}{cont}}%
             {\writeindexidentifierthree{dax}{openmp}{cont}{#1}}}
\newcommand*{\daxtbb}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacetwo{dax}{tbb}\indexnamespacetwo{dax}{tbb}}%
             {\writeindexidentifiertwo{dax}{tbb}{#1}}}
\newcommand*{\daxtbbcont}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacethree{dax}{tbb}{cont}\indexnamespacethree{dax}{tbb}{cont}}%
             {\writeindexidentifierthree{dax}{tbb}{cont}{#1}}}

\newcommand*{\daxopengl}[1]{%
  \ifthenelse{\equal{#1}{}}%
             {\writenamespacetwo{dax}{opengl}\indexnamespacetwo{dax}{opengl}}%
             {\writeindexidentifiertwo{dax}{opengl}{#1}}}

\newcommand*{\tparams}[1]{\textcode{<#1>}}

\newcommand*{\textfilename}[1]{\textsf{#1}}
\newcommand*{\daxheader}[2]{%
  \textfilename{#1\fshyp{}#2}\index{#1\fshyp#2}\index{#2}}

\newcommand*{\cmakevar}[1]{%
  \textsf{#1}%
  \index{#1}%
  \index{CMake configuration!#1}}

\lstnewenvironment{daxexample}[2][-*-]{
  \lstset{caption={#2}}
  \ifthenelse{\equal{#1}{-*-}}{}{\lstset{label=#1}}
}{
}

% Cite commands I use to abstract away the different ways to reference an
% entry in the bibliography (superscripts, numbers, dates, or author
% abbreviations).  \scite is a short cite that is used immediately after
% when the authors are mentioned.  \lcite is a full citation that is used
% anywhere.  Both should be used right next to the text being cited without
% any spacing.
\newcommand*{\lcite}[1]{~\cite{#1}}
\newcommand*{\scite}[1]{~\cite{#1}}

\newcommand{\etal}{et al.}

\newcommand*{\keyterm}[1]{\emph{#1}}

\newcommand{\fix}[1]{{\color{red}\textsc{[#1]}}}

% Avoid putting figures on their own page.
\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.95}
\renewcommand{\bottomfraction}{0.95}

% Make sure this is big enough so that only big figures end up on their own
% page but small enough so that if a figure does have to be on its own
% page, it won't push everything to the bottom because it's not big enough
% to have its own page.
\renewcommand{\floatpagefraction}{.75}

% Environments for tightly packed lists.
\newenvironment{enumeratetight}{
  \begin{enumerate}
    \setlength{\topsep}{0pt}
    \setlength{\itemsep}{0pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
    \setlength{\partopsep}{0pt}
}{
  \end{enumerate}
}

\newenvironment{itemizetight}{
  \begin{itemize}
    \setlength{\topsep}{0pt}
    \setlength{\itemsep}{0pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
    \setlength{\partopsep}{0pt}
}{
  \end{itemize}
}

\newenvironment{descriptiontight}{
  \begin{description}
    \setlength{\topsep}{0pt}
    \setlength{\itemsep}{0pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
    \setlength{\partopsep}{0pt}
}{
  \end{description}
}

\begin{document}

\sloppy

\maketitle

\begin{abstract}
  We are on the threshold of a transformative change in the basic
  architecture of high-performance computing.  The use of accelerator
  processors, characterized by large core counts, shared but asymmetrical
  memory, and heavy thread loading, is quickly becoming the norm in high
  performance computing.  These accelerators represent significant
  challenges in updating our existing base of software.  An intrinsic
  problem with this transition is a fundamental programming shift from
  message passing processes to much more fine thread scheduling with memory
  sharing.  Another problem is the lack of stability in accelerator
  implementation; processor and compiler technology is currently changing
  rapidly. This report documents the results of our three-year ASCR project
  to address these challenges. Our project includes the development of the
  Dax toolkit, which contains the beginnings of new algorithms for a new
  generation of computers and the underlying infrastructure to rapidly
  prototype and build further algorithms as necessary.
\end{abstract}

\clearpage

\chapter*{Acknowledgement}

Thanks to everyone who contributed to this project and helped make it a
success. Thanks to Kwan-Liu Ma from the University of California at Davis
for the encouragement to start the project and subsequent support. Thanks to
Berk Geveci and Utkarsh Ayachit from Kitware, Inc. for managing so many of
the management and technical details of the project. Thanks to Robert
Maynard from Kitware, Inc. for implementing the larger moiety of the code,
and thanks to Brad King for implementing the impossibly cool meta template
programs. Thanks to Robert Miller from the University of California at
Davis for providing the foundational research that make connectivity
possible. Finally, thanks to everyone in the SciDAC Scientific Data
Management, Analysis, and Visualization Institute for recognizing Dax as a
DOE solution for scientific visualization on advanced architectures.

This work was supported in whole by the DOE Office of Science, Advanced
Scientific Computing Research, under award number 10-014707, program
manager Lucy Nowell.

Sandia National Laboratories is a multi-program laboratory operated by
Sandia Corporation, a wholly owned subsidiary of Lockheed Martin
Corporation, for the U.S. Department of Energy's National Nuclear Security
Administration.


\cleardoublepage % TOC should start on an odd page
\tableofcontents
\listoffigures
%\listoftables
\lstlistoflistings

\clearpage

\chapter*{Executive Summary}
\addcontentsline{toc}{chapter}{Executive Summary}

\input{Summary}

\SANDmain % Start the main part of the document.

\chapter{Introduction}
\label{chap:Introduction}

\input{Introduction}

\chapter{Overview of Dax Toolkit}
\label{chap:Overview}

\input{Overview}

\chapter{Dax Toolkit Documentation}
\label{chap:Documentation}

\input{Documentation}

\chapter{Progress Report}
\label{chap:ProgressReport}

\input{ProgressReport}

\clearpage

\providecommand*{\phantomsection}{}
\phantomsection
\addcontentsline{toc}{chapter}{References}
\bibliographystyle{plain}
\bibliography{DaxReport2013}

\begin{flushleft}
  \clearpage
  \lhead[]{}
  \rhead[]{}
  \phantomsection
  \addcontentsline{toc}{chapter}{Index}
  \printindex
\end{flushleft}

\input{Distribution}

\end{document}
